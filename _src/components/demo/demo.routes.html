<link rel="stylesheet" media="screen" href="/public/css/demo/demo.css" />
{{#if hydrating}}
    <:Component {hydratingComponent} />
{{else}}
<Route ref:router path="/components/:demo" bind:match >
    {{#if match && !hydrating}}
        {{#await AsyncRoute(match.params.demo)}}
            <Demo>
                <div slot="header">Loading</div>
            </Demo>
        {{then response}}
            <:Component {response} />
        {{catch error}}
            {{error}}
        {{/await}}
    {{/if}}
</Route>
{{/if}}

<script>
    import Route from 'svelte-routing/Route.html';
    import Demo from './demo.wrapper.html';
    import store from './demo.store.js';
    import capitalize from '../tools/title-case.js';
    // import Async from '../async/async.html';

    export default {
        data: () => ({
            pageTitle: null,
            routeUrl: null,
        }),
        components: {
            Route, Demo
        },
        helpers: {
            component: (AsyncRoute) => {
                return AsyncRoute;
            },
            AsyncRoute: async (routeUrl) => {
                if (!routeUrl) { return false; }
                const route = await import(
                    /* "webpackChunkName": "demo-route.[request]", "webpackMode": "lazy" */
                    '@/components/' + routeUrl + '/' + routeUrl + '.demo.html'
                );
                return route.default;
            }
        },
        oncreate() {
            console.log('Demo Router Creation:', this);

            this.refs.router.observe('match', (match) => {
                const path = match.params ? match.params.demo : match;
                console.log(path);
                this.set({'routeUrl': path});
                store.set({'pageTitle': capitalize(path)});
            });
        },
        setup(DemoRouter) {},
        store: () => store
    };
</script>
