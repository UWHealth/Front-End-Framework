<:Head>
    <title>â†’ {{$pageTitle || pageTitle}} DEMO</title>
    <link rel="stylesheet" href="/public/css/demo/demo.css">
</:Head>

<!-- Svelte-routing: https://github.com/EmilTholin/svelte-routing -->
<nav ref:navigation>
    <NavLink to="/components/button/">Buttons</NavLink>
    <NavLink to="/components/generic/">Generic</NavLink>
    <NavLink to="/components/feed/">Feed</NavLink>
</nav>

<Route ref:router path="/components/:demo" bind:match>
    {{#await match ? Async(match.params.demo) : '{}'}}
        <Demo demoTitle="Loading" variants="{{true}}">
            <div slot="header"></div>
            <div slot="variants">Loading...</div>
        </Demo>
    {{then response}}
        <div transition:fade='{duration: 1000}'>
            <:Component {response.default} ref:response />
        </div>
    {{catch error}}
        {{error}}
    {{/await}}
</Route>

<script>
    import Route from 'svelte-routing/Route.html';
    import NavLink from 'svelte-routing/NavLink.html';
    import Demo from './demo.wrapper.html';
    import store from './demo.store.js';
    import { fade } from 'svelte-transitions';
    import capitalize from '../tools/title-case.js';

    export default {
        data() {
            return { pageTitle: 'DEMO' };
        },
        transitions: { fade },
        components: {
            Route,
            NavLink,
            Demo
        },
        helpers: {
            Async: (routeUrl) => {
                return import(
                    /* webpackChunkName: "demo", "webpackMode: "lazy-once" */
                    '@/components/' + routeUrl + '/' + routeUrl + '.demo.html'
                );
            }
        },
        oncreate() {
            console.log('Demo Router Creation:', this);

            this.refs.router.observe('pathname', (pathname) => {
                store.set({'url': pathname, 'pageTitle': this.refs.router});
            });

            this.refs.router.observe('match', (match) => {
                store.set({'pageTitle': capitalize(match.params.demo)});
            });
        },
        setup(DemoRouter) {},
        store: () => store
    };
</script>
