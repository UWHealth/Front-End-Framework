<Route ref:router bind:pathname bind:path>
    <:Component {innerComponent} thisPath="{{pathname}}"/>
</Route>

<script>
    import Route from 'svelte-routing/Route.html';
    import store from './demo.store.js';
    import capitalize from '@/components/tools/title-case';
    import findExport from '../tools/find-export.js';

    export default {
        components: {Route},
        data: () => ({
            pageTitle: null,
            routeUrl: null,
            currentRoute: '',
            path: '/components/:demo',
            ssr: false
        }),
        methods: {
            AsyncRoute: async (pathname) => {
                if (!pathname) { return false; }
                if (!window) {
                    const load = require.resolveWeak('@/components/' + pathname + '/' + pathname + '.demo.html');
                    // Find module in webpack cache
                    const mod = __webpack_modules__[load];
                    const component = requireModule(mod, load);
                    return () => component && component;
                }
                else {
                    const route = import(
                        /* "webpackChunkName": "demo-routes/[request]", "webpackMode": "lazy" */
                        '@/components/' + pathname + '/' + pathname + '.demo.html'
                    );
                    return route;
                }
            }
        },
        oncreate() {
            // console.log('Demo Router Creation:', this);
            this.set({'initialRoute': this.get('pathname')});

            this.refs.router.observe('match', (match) => {
                console.log('changed', this);
                const initial = this.get('initialRoute');
                const current = match && match.pathname;

                if (current !== initial && initial && match) {
                    this.AsyncRoute(
                        match.params.demo
                    ).then((component) => {
                        this.set({'innerComponent': component["default"]});
                        store.set({'pageTitle': capitalize(match.params.demo)});
                    });
                }
            });
        },
        setup(DemoRouter) {},
        store: () => store
    };

    function requireModule(mod, load) {
        // Reject any modules not found in webpack
        if (typeof mod === 'undefined') {
            return false;
        }
        // We pass the id, name
        return findExport(__webpack_require__(mod.name || mod.id || load));
    }

</script>
