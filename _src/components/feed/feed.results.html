{{#if results}}
    {{#each results.result.slice(pageStart, pageEnd) as result @title}}
        <div transition:slide class="media-object">
            {{#if description(result.description).image}}
                <div class="media-object__media">
                {{{description(result.description).image}}}
                </div>
            {{/if}}
            <div class="media-object__body">
                <strong>{{results.result.indexOf(result)}}: {{result.title}}</strong>
                <p>{{{description(result.description).text}}}</p>
            </div>
        </div>
        <hr>
    {{/each}}
{{/if}}

<style>
    .media-object__media img {
        max-width: 15rem !important;
        height: auto !important;
    }
</style>

<script>
    import { slide } from 'svelte-transitions';
    import { cubicOut } from 'eases-jsnext';
    import decodeEntities from '../tools/decode-html.js';

    export default {
        data() {
            return {
                results: false,
                page: 1,
                MAX_PER_PAGE: 10
            };
        },
        computed: {
            pageStart: (page, MAX_PER_PAGE) => {
                return page === 1 ? 0 : Math.max(0, (page - 1) * (MAX_PER_PAGE + 1));
            },
            pageEnd: (pageStart, MAX_PER_PAGE) => {
                return pageStart + MAX_PER_PAGE + 1;
            }
        },
        transitions: { slide },
        helpers: {
            cubicOut,
            description: (description) => {
                let text = Array.isArray(description) ? description[2] : description;
                let image = /(&lt;img[\s].*\/&gt;)/gi.exec(text);
                image = image ? image[0] :
                    Array.isArray(description) && description[1] ?
                        '&lt;img src="https://uconnect.wisc.edu' + description[1] + '"/&gt;'
                        : '';
                text = text.replace(image, '');

                return {text: decodeEntities(text), image: decodeEntities(image)};
            }
        },
        oncreate() {
            this.observe('page', (page) => {
                window.scroll(0, 0);
            });
        }
    };
</script>
