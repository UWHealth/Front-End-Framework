<Demo demoTitle="Feed Example" variants="{{true}}" currentRoute="feed">
    <div slot="header"></div>
    <div slot="variants">
        <List {{...props}} />
    </div>
</Demo>

<script>
    import Demo from '../demo/demo.wrapper.html';
    import List from './feed.html';

    import store from '@/components/demo/demo.store.js';

    export default {
        store: () => (window) ? window.store : store,
        components: { Demo, List },

        data() {
            return {
                feedUrl: "https://uconnect.wisc.edu/feeds/30m/json/homepage/index.json",
                MAX_PER_PAGE: 10,
                page: 1,
                feedResults: false
            };
        },
        computed: {
            feed: (feedResults) => feedResults,
            props: (feedUrl, feedResults, feed, page, MAX_PER_PAGE) => { return {feed, feedUrl, MAX_PER_PAGE, page, feedResults}; }
        },
        methods: {
            fetchFeed() {
                return fetch(this.get('feedUrl')).then(r => r.json()).catch(e => { return Promise.reject(e) });
            }
        },
        oncreate() {
            if (store.get('feedResults')) {
                this.set({"feedResults": store.get('feedResults')});
            }
            else {
                const feed = this.fetchFeed();
                feed.then((feed) => {
                    this.set({"feedResults": feed.results});
                    store.set({'feedResults': feed.results});
                })
                .catch(e => console.log(e));

            };
        }
    };
</script>
