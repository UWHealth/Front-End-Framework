{#if results && results.result}
{#each results.result.slice(pageStart, pageEnd) as result (result.title)}
<div class="media-object"
    in:slide="{duration: 300, easing: cubicOut}"
    out:fade="{duration: 100}"
    >
    <div class="media-object__media">
        {@html description(result.description).image && description(result.description).image}
    </div>
    <div class="media-object__body">
        <strong>{results.result.indexOf(result)}: {result.title}</strong>
        <p>{@html description(result.description).text}</p>
    </div>
</div>
{/each}
{/if}

<style>
    .media-object__media {
        display: flex;
        justify-content: center;
        align-items: center;
        border-radius: 2em;
        background-color: #124a79;
        width: 15rem;
        min-height: 10rem;
    }

    .media-object__media :global(img) {
        margin: auto !important;
        max-width: 100% !important;
        height: auto !important;
    }
</style>

<script>
import { slide, fade } from 'svelte-transitions';
import { cubicOut } from 'eases-jsnext';
import decodeEntities from '@/helpers/decode-html.js';

export default {
    transitions: { slide, fade },
    data() {
        return {
            results: false,
            page: 1,
            MAX_PER_PAGE: 10,
        };
    },
    computed: {
        pageStart: ({ page, MAX_PER_PAGE }) => {
            return page === 1
                ? 0
                : Math.max(0, (page - 1) * (MAX_PER_PAGE + 1));
        },
        pageEnd: ({ pageStart, MAX_PER_PAGE }) => {
            return pageStart + MAX_PER_PAGE + 1;
        },
    },
    helpers: {
        cubicOut,
        description: (description) => {
            let text = Array.isArray(description)
                ? description[2]
                : description;
            let image = /(&lt;img[\s].*\/&gt;)/gi.exec(text);
            image = image
                ? image[0]
                : Array.isArray(description) && description[1]
                ? '&lt;img src="https://uconnect.wisc.edu' +
                  description[1] +
                  '"/&gt;'
                : '';
            text = text.replace(image, '');

            return { text: decodeEntities(text), image: decodeEntities(image) };
        },
    },
    oncreate() {},
};
</script>
