<!-- doctype, html, and body are strings
    to prevent svelte from evaluating them -->
{ @html
    `<!DOCTYPE html>
    <html lang="en" itemscope itemtype="https://schema.org/Article">`
}
{ @html header }
{ @html '<body>' }
    { @html bodyHtmlSnippet }
    <div id="app" class="application">
        { @html appHtmlSnippet }
        {#if appComponent}
            { @html renderComponent(appComponent, props) }
        {/if}
    </div>
    <Footer></Footer>
    { @html '<script>' + exportedState + '</script>' }
{ @html `
    </body></html>
` }

<script>
import HeadTemplate from '@/components/head';
import Footer from '@/components/footer?ssr';
import webmanifest from '@/static/manifest.webmanifest';
import browserConfig from '@/static/browserconfig.xml';

export default {
    components: { Footer },
    data: () => ({
        appComponent: null,
        fileManifest: {},
        googleAnalytics: null,
        meta: [],
        links: [],
        inlineStyle: '',
        scripts: [],
        webmanifest: webmanifest,
        browserConfig: browserConfig,
        title: 'Front-End-Framework',
        headHtmlSnippet: '',
        appHtmlSnippet: '',
        bodyHtmlSnippet: '',
        fromServer: {
            pathname: '/',
            componentPath: '/',
            request: {},
        },
    }),
    helpers: {
        renderComponent: (appComponent, props) => {
            if (!appComponent) return '';
            return appComponent.render
                ? appComponent.render(props)
                : appComponent.html;
        },
    },
    computed: {
        // Convenient way to pass entire state to components
        props: (state) => state,

        // Pass head state to handlebars template
        header: (state) => HeadTemplate(state),

        // Add the initial page state to the window,
        // Allowing our app to hydrate
        exportedState: ({ fromServer, fileManifest }) => {
            let { pathname, componentPath, request } = fromServer;
            request = request
                ? {
                      url: request.url,
                      headers: request.headers,
                      method: request.method,
                  }
                : '""';
            return (
                `console.log('Manifest', ${JSON.stringify(fileManifest)});` +
                `window.__APP_STATE__ = { ` +
                `  initialRoute: "${pathname}",` +
                `  componentPath: "${componentPath}",` +
                `  request: ${JSON.stringify(request)}` +
                `};`
            );
        },
    },
};
</script>
