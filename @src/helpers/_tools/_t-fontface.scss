//------------------------------------
//      $FONT FACE TOOL
//------------------------------------

/* SG
# Typography/Font Face [[dev]]

##### `@include-web-fonts()`
###### mixin(`$font-map: $web-fonts`)
A wrapper function for `@font-face()`. Takes a configuration map and passes the keys to `@font-face()`. Loops through each font-name's (root map keys) weight and style.

Font file names must be the same as their CSS font-family values. Example: arial font, 400 weight would be arial-400.ttf and the CSS value would be font-family: 'arial'; font-weight: 400.

@requires `@font-face()`

*/


//------------------------------------
//    $EXAMPLE
//------------------------------------
//	This may be useful if you would rather generate your own font-face,
//	or if you'd like to include some specialty fonts that aren't easy to
//	feed into the mixin.

//@font-face {
//    font-family: 'Asap';
//    src: url('fonts/Asap-Regular-webfont.eot');
//    src: url('fonts/Asap-Regular-webfont.eot?#iefix') format('embedded-opentype'),
//         url('fonts/Asap-Regular-webfont.woff') format('woff'),
//         url('fonts/Asap-Regular-webfont.ttf') format('truetype'),
//         url('fonts/Asap-Regular-webfont.svg#AsapRegular') format('svg');
//    font-weight: 400;
//    font-style: normal;
//
//}

@mixin include-web-fonts($font-map: $web-fonts) {
    @each $name in map-keys($font-map) {
        $inner-map: map-get($font-map, $font-name);

        $weights: map-get($inner-map, 'weights');
        $italics: map-get($inner-map, 'italics');
        $formats: map-get($inner-map, 'formats');
        $path: map-get($inner-map, 'path') or $font-file-location;

        @each $weight in $weights {
            @include font-weights($name, $path, $weights, $formats);
        }
        @each $weight in $italics {
            @include font-weights($name, $path, $weights, $formats, italic);
        }
    }
}

@mixin font-weights($name, $path, $weight, $formats, $style: '') {
    $style-string: if($style, '-#{$style}', '');
    $svg-id: ('##{$name}#{$weight}#{$style}');
    $font-name: #{$path}/#{unquote('#{$name}-#{$weight}#{$style-string}')};

    $fonts: join-formats($font-name, $formats);

    $eot: map-get($fonts, 'eot');
    $font-files: map-get($fonts, 'font-files');

    @include font-face(
        $name,
        $font-files,
        $weight,
        $style,
        $eot
    );
}


/* SG
##### `@font-face()`
###### mixin(`$name`, `$font-files`, `$weight:false`,` $style:false`, `$eot:false`)
Generates cross-browser font-face declarations when called.
$name is required, arbitrary, and what you will use in font stacks.
**Arguments:**
* $font-files is required using font-files('relative/location', 'format'). For best results use this order: woff, opentype/truetype, svg
* $eot is required by IE, and is a relative location of the eot file.
* $weight shows if the font is bold, defaults to normal
* $style defaults to normal, might be also italic

Based on [Compass' font-face mixin](http://compass-style.org/reference/compass/css3/font_face/).
*/

@mixin font-face(
    $name,
    $font-files,
    $weight: false,
    $style: false,
    $eot: null
){

    $iefont: unquote("'#{$eot}?#iefix'");
    @font-face {
        font-family: quote($name);
        @if $eot {
            src: url($eot);
            $font-files: url($iefont) unquote("format('embedded-opentype')"), $font-files;
        }
        src: #{$font-files};
        @if $weight {
            font-weight: #{$weight};
        }
        @if $style {
            font-style: #{$style};
        }
    }
}

@function join-formats($font-name, $formats) {
    $font-files: ();
    $eot: null;

    @each $format in $formats {
        $extension: if($format == 'svg', 'svg#{svg-id}', $format);

        @if $format == 'eot' {
            $eot: '#{$font-name}.eot';
        }
        @else {
            $font-files: join(
                unquote('url("#{$font-name}.#{extension}") format("#{format}")'),
                $font-files
            );
        }
    }

    @return (
        'font-files': $font-files,
        'eot': $eot
    );
}
