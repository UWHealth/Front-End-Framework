<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{{customVars.pageTitle}}</title>
    <script src="../js/vendor/modernizr-2.6.2-respond-1.1.0.min.js"></script>
    <link rel="stylesheet" href="../css/main.css" media="screen">
    {{> theme}}
    {{> highlight}}
</head>
<body>
<main class="styleguide-wrap">
    {{!--Menu--}}
    <nav id="styleguide-menu">
        <div id="styleguide-menu-wrap">
        {{#each menus}}
        {{#eachProperty this}}
            <ul class="top_menu">
                <li>
                    <a href="#{{key}}" class="sectionlink show_all menu_link">{{titleize key}}</a>
                    <span class="submenu_toggle toggle_active" data-toggle="#sub-{{key}}" data-toggle-type="slide">&#9662;</span>
                </li>
            </ul>
            <ul id="sub-{{key}}" class="menu_body">
            {{#eachProperty value}}
                <li>
                {{#with value}}
                {{#if headings.1.name}}
                    <a class="submenulink menulink_with_subs" href="#{{sanitize headings.0.id}}">{{name}}</a>
                    <span class="submenu_toggle"
                        data-toggle="[data-submenu='{{headings.0.name}}']"data-toggle-type="slide">&#9662;</span>
                    <ul class="submenu" data-submenu="{{headings.0.name}}">
                    {{#each headings}}
                        <li>
                            <a href="#{{sanitize id}}" class="submenulink sub-sub menu_link">{{name}}</a>
                        </li>
                    {{/each}}
                    </ul>
                {{else}}
                    <a class="sectionlink menu_link" href="#{{sanitize headings.0.id}}">{{name}}</a>
                {{/if}}
                </li>
                {{/with}}
            {{/eachProperty}}
            </ul>
        {{/eachProperty}}
        {{/each}}
        <div class="top_menu">
            <a href="#" class="sectionlink show_all menu_link">Show All</a>
        </div>
        </div>
    </nav>

    {{!--SECTIONS--}}
    <section id="styleguide">
        <div class="wrap">
        {{#if sections}}

        <div id="styles" class="section_container style_sections" data-section="style styles">
            <header class="section section_starter">
                <h1 class="h3">Styles</h1>
            </header>
        	{{#each sections}}
        		<article class="section" id="{{sanitize id}}" data-section="{{sanitize section}}" data-heading="{{sanitize heading}}">
                    <header class="section_header">
                    {{#unless isSubsection}}
                        <h1 class="h4 header_heading">{{section}}</h1>
                    {{else}}
                        <h1 class="h6 header_subheading">{{section}}</h1>
                        <h2 class="h4 space_t_neg header_heading">{{heading}}</h2>
                    {{/unless}}
                    </header>
                    <div class="section_comment">
                        {{{comment}}}
                    </div>
                    {{#if code}}
                    <div class="section_body">
                        <div class="result">
                            {{{code}}}
                        </div>
                    {{/if}}
                    {{#if markup}}
                        <div class="markup hljs">
                            <pre><code>{{{markup}}}</code></pre>
                        </div>
                    </div>
                    {{/if}}
        		</article>
        	{{/each}}
        </div>
        {{/if}}

        {{#if developmentSections}}
        <div id="development" class="section_container dev_sections" data-section="styleguide-dev">
            <header class="section section_starter">
                <h1 class="h3">Development</h1>
            </header>
            {{#each developmentSections}}
        		<article class="section" id="{{sanitize id}}" data-section="{{sanitize section}}" data-heading="{{sanitize heading}}">
                    <header class="section_header">
                    {{#unless isSubsection}}
                        <h1 class="h4 header_heading">{{section}}</h1>
                    {{else}}
                        <h1 class="h6 header_subheading">{{section}}</h1>
                        <h2 class="h4 space_t_neg header_heading">{{heading}}</h2>
                    {{/unless}}
                    </header>
                    <div class="section_comment">
                        {{{comment}}}
                    </div>
                    {{#if code}}
                    <div class="section_body">
                        <div class="result">
                            {{{code}}}
                        </div>
                    {{/if}}
                    {{#if markup}}
                        <div class="markup hljs">
                            <pre><code>{{{markup}}}</code></pre>
                        </div>
                    </div>
                    {{/if}}
        		</article>
        	{{/each}}
        </div>
        {{/if}}
    </div>
    </section>
</main>
<!--JQuery-->
<!--[if lte IE 8]>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>
<![endif]-->

<!--[if gt IE 8]><!-->
{{> jquery}}
<!--<![endif]-->

{{#each customVars.scripts}}
    <script src="{{this}}"></script>
{{/each}}

<script type="text/javascript">
    //Tab functions
    $(function() {
        $("body").tabbed({
            wrapper: {
                element: "section",
                "class_string": "tabbed",
                extra_classes: ""
            },
            tabs: {
                animation: {
                    opacity: [1, 0],
                    duration: 400
                },
                active_class: 'active'
            }
        });

        $('#styleguide-menu-wrap').stick_in_parent();
    });

    // Style Guide-specific functions
    // Show and hide sections
    $(function() {
        var History = window.History;
        var $menu = $("#styleguide-menu");
        var $sections = $('#styleguide .section');
        var Title = document.title;

        $sections.hide();

        var updateMenu = function(state) {
            var $menuItem = $menu.find('a[href="#'+state+'"]').not('.toggle');
            $menu.find('a.on').removeClass('on');
            $menuItem.addClass('on');

            if ($menuItem.hasClass('menulink_with_subs')){
                $menuItem.closest('.submenu').siblings('.submenulink').addClass('on')
                .siblings('.submenu_toggle').not('.toggle_active').trigger('click');
            }
        };

        var updateContent = function(state, hash){
            var sectionID = "#"+state;
            try {
                var $section = $('#styleguide').find(sectionID);
                var dataSection = "[data-section='"+$section.data('section')+"']";

                    $sections.hide();
                    //show all articles of the same sections
                    $(dataSection).show();

                    //Handle section containers
                    $section.children($sections).show()
                        $('html, body').animate({
                            scrollTop: $section.offset().top
                        }, 200);

            }catch(err){
                //Just show all sections if section doesn't exist
                $sections.show();
            }
        };

        var getState = function(e){
            var state = History.getState();
            if (window.location.pathname == state.hash) {
                $sections.show();
            }else{
                var replacement = window.location.pathname + '?section=';
                var saneState = state["hash"].replace(replacement,"");
                saneState = saneState.replace("&_suid="+state.id, "");
                updateMenu(saneState);
                updateContent(saneState);
            }
        }

        //On hashchange
        $(window).on('hashchange', function(e){
            var winHash = window.location.hash;
            var winState = winHash.replace("#", "");
            var stated = "?section=" + winState;
            History.pushState(null, Title, stated);
            return false;
        });

        //Bind history change
        History.Adapter.bind(window, 'statechange', function(e){
            getState();
        });

        //Get state of document on load
        getState();

    });
</script>
</body>
</html>
