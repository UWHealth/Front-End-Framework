<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{{customVars.pageTitle}}</title>
    <script src="../js/vendor/modernizr-2.6.2-respond-1.1.0.min.js"></script>
    <link rel="stylesheet" href="../css/main.min.css" media="screen">
    {{> highlight}}
    {{> theme}}
    <!--JQuery-->
    <!--[if lte IE 9]>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>
    <![endif]-->

    <!--[if gt IE 9]><!-->
    {{> jquery}}
    <!--<![endif]-->
</head>
<body>
<main class="styleguide-wrap">
    {{!--Menu--}}
    <nav id="styleguide-menu" class="sg-menu">
        <div id="styleguide-menu-wrap">
            <h1 class="sg-logo h5 space_0"><a href="#" class="sectionlink show_all menu_link">Front-End Framework</a></h1>
            {{#each menus}}
            {{#eachProperty this}}
            <ul class="top_menu">
                <li>
                    <a href="#{{key}}" class="sectionlink show_all menu_link">{{titleize key}}</a>
                    <span class="topmenu_toggle submenu_toggle toggle_active" data-toggle="#sub-{{key}}" data-toggle-type="slide">&#9662;</span>
                </li>
            </ul>
            <ul id="sub-{{key}}" class="menu_body">
                {{#eachProperty value}}
                {{#with value}}
                <li>
                    {{#if headings.1.name}}
                    <a class="submenulink menulink_with_subs" href="#{{sanitize headings.0.id}}">{{name}}</a>
                    <span class="submenu_toggle"
                        data-toggle="[data-submenu='{{headings.0.name}}']"data-toggle-type="slide">&#9662;</span>
                    <ul class="submenu" data-submenu="{{headings.0.name}}">
                    {{#each headings}}
                        <li>
                            <a href="#{{sanitize id}}" class="submenulink sub-sub menu_link">{{name}}</a>
                        </li>
                    {{/each}}
                    </ul>
                    {{else}}
                    <a class="sectionlink menu_link" href="#{{sanitize headings.0.id}}">{{name}}</a>
                    {{/if}}
                </li>
                {{/with}}
                {{/eachProperty}}
            </ul>
            {{/eachProperty}}
            {{/each}}
        </div>
    </nav>

    {{!--SECTIONS--}}
    <main id="styleguide">
        <div class="wrap">
        {{#each sections}}
            <section id="{{@key}}" class="sg-section {{@key}}-section" data-section="{{@key}}">
                <div class="sg-article sg-section_start">
                    <h1 class="sg-heading sg-heading-section h3">{{titleize @key}}</h1>
                </div>
                {{#each this}}

                <div class="sg-category">
                    {{#if articles.[1]}} {{!--Check for more than one article --}}
                    <header class="sg-article sg-category_header" data-section="{{sanitize name}}">
                        <h2 class="sg-heading-category h4">
                            {{name}}
                        </h2>
                    </header>
                    {{/if}}
                {{#each articles}}
                <article class="sg-article" id="{{sanitize id}}" data-section="{{sanitize category}}" data-heading="{{sanitize heading}}">
                    <header class="sg-article_header pad_b{{#unless heading}} sg-category_header{{/unless}}">
                        <h3 class="sg-heading sg-heading-article h4">
                            {{~#if heading~}}
                                {{heading}}
                            {{else}}
                                {{category}}
                            {{~/if~}}
                        </h3>
                        {{~#if isDevelopment~}}
                            <code class="sg-codespan">{{fileLocation}}</code>
                        {{~/if}}
                    </header>

                    <div class="sg-article_comment">
                        {{{comment}}}
                    </div>
                    {{#if code}}
                    <div class="sg-article_example">
                        {{#each code}}
                        <div class="sg-result">{{{this}}}</div>
                        {{/each}}
                    {{/if}}
                    {{~#if markup~}}
                        {{#each markup}}
                        <div class="sg-article_markup sg-markup hljs">
                            <pre class="sg-markup_wrap"><code>{{{this}}}</code></pre>
                        </div>
                        {{/each}}
                    </div>
                    {{~/if}}
                </article>
                {{/each}}
                </div>
                {{~/each}}
            </section>
        {{~/each}}
        </div>
    </main>

{{!--Custom Script includes--}}

{{#each customVars.scripts}}
    <script src="{{this}}"></script>
{{/each}}

<script>
    // Style Guide-specific functions
    $(function() {

        //Sticky left menu
        $('#styleguide-menu-wrap').stick_in_parent();
        $('.sg-category_header').stick_in_parent();
        $('.sg-article_header').stick_in_parent({
            bottoming: true
            }).on('sticky_kit:bottom', function(){
                $(this).addClass('is_stuck_bottom');
            }).on('sticky_kit:unbottom sticky_kit:stick sticky_kit:unstick', function(){
                $(this).removeClass('is_stuck_bottom');
            });
        $('.is_stuck_bottom').removeClass('is_stuck_bottom');

        var History = window.History;
        var $menu = $("#styleguide-menu");
        var $sections = $('#styleguide .sg-article');
        var Title = document.title;

        // Show and hide sections
        $sections.hide();

        function updateMenu(sectionID) {
            var $menuItem = $menu.find('a[href="'+sectionID+'"]').not('.toggle');
            $menu.find('a.on').removeClass('on');
            $menuItem.addClass('on');

            var $parentToggle = $menuItem.closest('.submenu').prev();

            //Toggle other menu accordions off
            $('.toggle_active').not($parentToggle).not('.topmenu_toggle').trigger('click');

            //Make sure top menu clicks "sink" down to their first menu item
            if ($menuItem.hasClass('menulink_with_subs')){
                $menuItem.closest('.submenu').siblings('.submenulink').addClass('on')
                .siblings('.submenu_toggle').not('.toggle_active').trigger('click');

            }else if($menuItem.hasClass('sub-sub')){

                $menuItem.closest('ul').siblings('.submenu_toggle').not('.toggle_active').trigger('click');

            }
        };

        function updateContent(state, hash){
            if (state.indexOf('heading-_') > -1 ){
                var $heading = $("#"+state);
                var sectionID = $heading.closest('.sg-article').attr('id');
                sectionID = "#" + sectionID;
            }else {
                var sectionID = "#"+state;
            }

            try {
                var $section = $('#styleguide').find(sectionID);
                var dataSection = "[data-section='"+$section.data('section')+"']";
                var $scrollTo = $heading ? $heading : $section;

                    $sections.hide();
                    //show all articles of the same sections
                    $(dataSection).show();

                    //Handle section containers
                    $section.find($sections).show()
                        $('html, body').animate({
                            scrollTop: Math.max(0, ($scrollTo.offset().top - 65))
                        }, 200);

                updateMenu(sectionID);

            }catch(err){
                //Just show all sections if section doesn't exist
                $sections.show();
                console.log(err);
            }

            $('.is_stuck_bottom').removeClass('is_stuck_bottom');
        };

        function getState(e) {
            var state = History.getState();
            if (window.location.pathname == state.hash) {
                $sections.show();
            }else{
                var replacement = window.location.pathname + '?section=';
                var saneState = state["hash"]
                    .replace(replacement,"")
                    .replace("&_suid="+state.id, "");
                updateContent(saneState);
            }
        }
        $(window).on('hashchange', function(e) {
            e.preventDefault();
        });
        //On hashchange
        $(window).on('hashchange', function(e) {
            var winHash = window.location.hash;
            var winState = winHash.replace("#", "");
            var stated = "?section=" + winState;

            History.replaceState(null, Title, stated);

            return false;
        });

        //Bind history change
        History.Adapter.bind(window, 'statechange', function(e){
            getState();
        });

        //Get state of document on load
        getState();

        //Wrap code references in links
        $('.global').each(function(i){
          if (!($(this).parent().hasClass('sg-heading'))){
            var id = $(this).data('code-id');
                id = "_"+id+"_";

            if($('#heading-'+id).length > 0) {
            	var aWrapper = '<a class="code_reference" href="#heading-'+id+'"></a>';
            	$(this).wrap(aWrapper);
            }
          }
        });


    });
</script>
</body>
</html>
