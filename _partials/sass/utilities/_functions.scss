// CONTENTS
// INTRODUCTION.........Explanation.
// REFERENCE............List of functions and how to use them.
// MATH.................Complex calculations and variables.
// HELPERS..............Simple functions to fix some features missing in Sass.
// TYPOGRAPHY...........Most often referenced from within type/_typography.scss.
// MODULAR SCALE........Making typographic scaling more harmonious.
// COLORS...............Calculating color differences.
// LISTS................Mixins for easier control of lists.


//------------------------------------
// $INTRODUCTION
//------------------------------------

// General functions to make Sass a little more powerful. Taken from various places.

//------------------------------------
// $REFERENCE
//------------------------------------
//NOTE: Words in brackets[] represent values. Can either be strings, numbers, or variables depending on context.

// exponent.......Exponentially multiply (cube, square, etc) a number.
//                exponent([number-you-want-to-multiply], [exponent]);

// pow............A more robust exponent multiplication which allows for decimal-based exponents.
//    ............This replaces Compass' pow() function.
//                pow([number-you-want-to-multiply], [exponent]);

//gcd.............Greatest Common Divisor calculation
//   .............(useful for calculating grids and widths)
//                gcd([first-number], [second-number])

//nth_root........Advanced calculation for squareroots, cuberoots, etc. of a value.
//                nth_root([number-you-want-to-find-the-root-of], [root-divisor]);

//sqrt............Find the square root of a value.
//                sqrt([number-you-want-the-square-root-of]);

//rand............Generate a random number.
//                rand();

// golden.........Generate the golden ratio.
//                golden();

// strip-units....Remove px,em,rem, etc. from a value. Usually a variable.
//                strip-units([value-you-want-units-removed-from]);

// opacity........MIXIN used to generate cross-browser opacity (including IE8)
//                @include opacity([decimal-number-you-need-for-opacity]);

// rems...........MIXIN used to generate rem value with a pixel fall-back
//     ...........(only accepts pixel values).
//                @include([property-you-want-to-give-a-value], [pixel-value]);

// rems...........function used to generate rem values from pixels.
//     ...........Accepts a base-font-size override for various media-query contexts.
//                @include([pixel-value-you-need-converted], [base-font-size-override]);

// str-contains...advanced function to parse a string for a value from a position.
//     		   str-contains([string-you-need-parsed],[sub-string], [start-position]);

// str-join......function to convert a list to a string.
//     		   str-join([list-you-need-converted],[list-seperator]);

//baseline-calc ..Used generating line-heights that line up to the baseline grid.
//              ..Override recommended behavior with a boolean third value to gain
//              ..most eye-pleasing values.
//                baseline-calc([font-size-in-pixels], [base-font-size],
//                              [override: true||false]);

//type-font-size..MIXIN used for generating font-sizes and line-heights
//              ..that line up to the baseline grid. Dependent on baseline-calc.
//                @include([font-size-in-pixels]);

//type-space......MIXIN used for generating spacing
//          ......which cooresponds to the baseline grid.
//          ......The values you enter should be value-less as they will be
// 		 ......calculated as multiples.
//@include type-space([property-you-want-to-give-a-value], [multiple-of-spacing]);

//type-space-sc...MIXIN used for generating spacing for properties
//             ...that accept shortcut values (e.g. padding: 2px 3px 4px 5px).
//             ...The values you enter should be value-less
//             ...as they will be calculated as multiples.
//  @include type-space([property-you-want-to-give-a-value],
//                      [top-value], [right-value],
//                      [bottom-value], [left-value]);
//  NOTE: This also accepts just a vertical(top) value and horizontal(right)-value. Assumes bottom = top, and left = right.

//modular-scale...Generates a pixel value that is an exponent of a ratio
//              ....(defaults to $scale-ratio value).
//                modular-scale([number-on-the-scale-you-want],
//                              [ratio-to-use-as-scale]);

//type-scale......MIXIN for generating numbers for properties on
//          ......the typographic scale (with a rem value and pixel fallback).
//                @include type-scale([property-you-want-to-use],
//                                    [number-on-the-scale]);

//headings-scale..MIXIN for generating heading sizes on a typographic scale.
//              ..Accepts any scale ratio.
//                @include headings-scale([scale-you-want-to-base-font-sizes-on]);

//type...........function for finding the value of an indexed type-size.
// ...........H1-H6, p, and small are all indexed values.
//    ...........px, rem, and line-height are available.
//               type([referenced-font-size],[font-size-value])

//color..........function for grabbing colors as defined by $colors map.
//	    ..........color([color-name], [optional-variation])

//set-text-color..Generates either white or black based on the
//              ..lightness of the color you pass it (Accepts HEX values).
//                set-text-color([color-you-need-to-test-contrast-of]);

//pick_best_color..Outputs the color with the highest contrast to the first color
//               ..you pass it (Accepts multiple color options).
//                 pick_best_color([color-you-need-to-test-contrast-of],
//                                ([color-option-1], [color-option-2], [...])
//                                );



//------------------------------------
//  $MATH
//------------------------------------

// All functions taken from SassyMath:
// https://github.com/Team-Sass/Sassy-math/blob/master/sass/math.scss

//Useful variables for calculating math functions
$pi: 3.1415926535897932384626433832795028841971693993751;
$π: $pi;
$e: 2.71828182845904523536028747135266249775724709369995;

$iter: 50;

// Exponent function (for square, cubes, etc.)
@function exponent($base, $exponent) {
	// reset value
	$value: $base;
	// positive intergers get multiplied
	@if $exponent > 1 {
	@for $i from 2 through $exponent {
		$value: $value * $base; } }
	// negitive intergers get divided. A number divided by itself is 1
	@if $exponent < 1 {
		@for $i from 0 through -$exponent {
			$value: $value / $base; } }
	// return the last value written
	@return $value;
}

//More advanced exponent function — very similar to Compass' pow() function, except all SASS-based.
@function pow($base, $exponent, $prec: 12) {
  // Handles decimal exponents by trying to convert them into a fraction and then use a nth_root-algorithm for parts of the calculation
	@if (floor($exponent) != $exponent) {
		$prec2 : pow(10, $prec);
		$exponent: round($exponent * $prec2);
		$denominator: gcd($exponent, $prec2);
		@return nth_root(pow($base, $exponent / $denominator), $prec2 / $denominator, $prec);
	}

	$value: $base;
	@if $exponent > 1 {
		@for $i from 2 through $exponent {
			$value: $value * $base;
		}
	} @else if $exponent < 1 {
		@for $i from 0 through -$exponent {
			$value: $value / $base;
		}
	}

	@return $value;
}

//Greatest Common Divisor
@function gcd($a, $b) {
  // From: http://rosettacode.org/wiki/Greatest_common_divisor#JavaScript
  @if ($b != 0) {
	  @return gcd($b, $a % $b);
  } @else {
	  @return abs($a);
  }
}

//Least common Multiple
//Use with caution...if there is no LCM, then you compilation will error out.
@function lcm($a, $b) {
	$a: round($a);
	$b: round($b);
	$gcd: gcd($a, $b);
	$result: ($a * $b) / $gcd;
	@return $result;
}


//Nth Root Function
@function nth_root($num, $n: 2, $prec: 12) {
  // From: http://rosettacode.org/wiki/Nth_root#JavaScript
	$x: 1;

	@for $i from 0 through $prec {
		$x: 1 / $n * (($n - 1) * $x + ($num / pow($x, $n - 1)));
	}

	@return $x;
}

//Square Root functions
@function sqrt($number) {
	$guess: random(20);
	$root: $guess;
	@for $i from 1 through $iter {
		$root: $root - (pow($root, 2) - $number) / (2 * $root);
	}
	@return $root;
}

//Golden Ratio generator.
@function golden() {
	@return 1/2 + sqrt(5) / 2;
}

$golden_ratio: golden();

//Sine
// From: https://unindented.org/articles/trigonometry-in-sass/
@function sin($angle) {
	$sin: 0;
	$angle: rad($angle);
	// Iterate a bunch of times.
	@for $i from 0 through 10 {
		$sin: $sin + pow(-1, $i) * pow($angle, (2 * $i + 1)) / fact(2 * $i + 1);
	}
	@return $sin;
}

//Cosine
@function cos($angle) {
	$cos: 0;
	$angle: rad($angle);
	// Iterate a bunch of times.
	@for $i from 0 through 10 {
		$cos: $cos + pow(-1, $i) * pow($angle, 2 * $i) / fact(2 * $i);
	}
	@return $cos;
}

//Tangent
@function tan($angle) {
	@return sin($angle) / cos($angle);
}

// Math helpers
// From https://github.com/inuitcss/tools.functions/blob/master/_tools.functions.scss
//
// Halve and double numbers, returning rounded integers. E.g.:
//
// .foo {
//     padding: halve(3.2px);
// }
//
// Outputs:
// .foo{padding: 2px;}
//
@function quarter($number) {
	@return round($number / 4);
}

@function halve($number) {
	@return round($number / 2);
}

@function double($number) {
	@return round($number * 2);
}

@function quadruple($number) {
	@return round($number * 4);
}

//------------------------------------
//    $HELPERS
//------------------------------------

// Strip units from a sass value
// Taken from:
// http://stackoverflow.com/questions/12328259/how-do-you-strip-the-unit-from-any-number-in-sass
@function strip-units($value) {
	@return $value / ($value * 0 + 1);
}

// Percent to Decimal
//
@function percentage-to-decimal($percentage) {
	@if unit($percentage) == '%' {
		$percentage: $percentage/100%;
	}
	@return $percentage;
}

//Viewport width from pixel converter
// Converts pixel dimensions to viewport
@function px-to-vw($pixel-val) {
	$vw-context: (1000*.01) * 1px;
	@return ($pixel-val/$vw-context) * 1vw;
}


@function list-to-string($list, $separator: ",") {
	$string: "";

	@for $i from 1 through length($list) {
		$string: str-append($string, #{nth($list, $i)});

		@if $i != length($list) {
			$string: str-append($string, $separator);
		}
	}

	@return $string;
}

//Stripped REM generator
//Useful if you just need the rem value
@function px-to-rems($size, $base-font:$base-font-size) {
	@if (unitless($size)){
		$size: $size * 1px;
	}

	$size: ($size / $base-font) * 1rem;

	@if $size == 0rem {
		$size: 0;
	}

	@return $size;

}

//Same as above
@function rems($size, $base-font:$base-font-size) {
	@return px-to-rems($size, $base-font);
}

//String Helpers
//-----------------------------------
// Taken from: https://github.com/devatrox/Sunglass

// String contains check
// Outputs true/false based on inputs
@function str-contains($string, $substr, $pos: 0) {

	$string: str-slice($string, $pos);

	@if str-index($string, $substr) != null {
		@return true;
	}
	@else {
		@return false;
	}
}

//String Append
// Adds string to end of another string
@function str-append($string, $insert) {
  $string: if($string == null, "", $string);

  @return str-insert($string, $insert, str-length($string) + 1);
}

//String Join
// Converts list to a string with an optional separator
@function str-join($list, $separator: ",") {
	@return list-to-string($list, $separator);
}

// List contains check
// Outputs true/false
@function list-contains($list, $var) {
	@return index($list, $item) != null;
}


//List print
@function list-print($string, $n) {
	$output: '';

	@if $n > 0 {
		@for $i from 1 through $n {
			$output: $output + $string;
		}
	}

	@return $output;
}


//Map Helpers
//-----------------------------------
//Taken from: http://www.sitepoint.com/extra-map-functions-sass/

//Deep Set
//Update a deeply nested map key.
@function map-deep-set($map, $keys... /*, $value */) {
	$map-list: ($map,);
	$result: null;

	@if length($keys) == 2 {
		@return map-merge($map, (nth($keys, 1): nth($keys, -1)));
	}

	@for $i from 1 through length($keys) - 2 {
		$map-list: append($map-list, map-get(nth($map-list, -1), nth($keys, $i)));
	}

	@for $i from length($map-list) through 1 {
		$result: map-merge(nth($map-list, $i), (nth($keys, $i): if($i == length($map-list), nth($keys, -1), $result)));
	}

	@return $result;
}

//Map depth finder
// Returns a map's depth. Useful for debugging maps.
@function map-depth($map) {
	$level: 1;

	@each $key, $value in $map {
		@if type-of($value) == "map" {
			$level: max(map-depth($value) + 1, $level);
		}
	}

	@return $level;
}

//Check multiple map keys
@function map-has-keys($map, $keys...) {
	@each $key in $keys {
		@if not map-has-key($map, $key) {
			@return false;
		}
	}

	@return true;
}

@function map-contains-keys($map, $keys...){
	@return map-has-keys($map, $keys);
}

//Check for deep map keys
@function map-has-nested-keys($map, $keys...) {
	@each $key in $keys {
		@if not map-has-key($map, $key) {
			@return false;
		}

		$map: map-get($map, $key);
	}

	@return true;
}
@function map-contains-nested-keys($map, $keys...) {
	@return map-has-nested-keys($map, $keys);
}

//Get map value at nested or 'deep' key, per $keys list
@function map-get-nested($map, $keys...) {
	@each $key in $keys {
		@if type-of($map) != 'map' {
			@return $map;
		}
		$map: map-get($map, $key);
	}
	@return $map;
}

//Map Extend
// Similar to jQuery's extend function but for sass maps
// Takes two maps and merges their differences
@function map-extend($map, $maps... /*, $deep */) {
	$last: nth($maps, -1);
	$deep: $last == true;
	$max: if($deep, length($maps) - 1, length($maps));

	// Loop through all maps in $maps...
	@for $i from 1 through $max {
		// Store current map
		$current: nth($maps, $i);

		// If not in deep mode, simply merge current map with map
		@if not $deep {
			$map: map-merge($map, $current);
		} @else {
			// If in deep mode, loop through all tuples in current map
			@each $key, $value in $current {

				// If value is a nested map and same key from map is a nested map as well
				@if type-of($value) == "map" and type-of(map-get($map, $key)) == "map" {
					// Recursive extend
					$value: map-extend(map-get($map, $key), $value, true);
				}

				// Merge current tuple with map
				$map: map-merge($map, ($key: $value));
			}
		}
	}

	@return $map;
}


//Map printer
//Print maps into a string
// Useful for debugging maps.
// Taken from: https://github.com/lunelson/sass-maps-plus

@function map-inspect($map, $level: 1) {
	$tab: '    ';
	$cr: '
';

	@if type-of($map) != 'map' {
		@return '#{inspect($map)}';
	}

	$indent: list-print($tab, $level + 1);
	$output: '(' + $cr + $indent; $i: 1;

	@each $key, $value in $map {
		@if type-of($value) == 'map' {
			$output: $output + '#{$key}: #{map-inspect($value, $level+1)}';
		} @else {
			$output: $output + '#{$key}: #{$value}';
		}

		@if $i < length(map-keys($map)) {
			$output: $output + ',' + $cr + $indent;
		}

		$i: $i + 1;
	}

	$outdent: list-print($tab, $level);

	@return $output + $cr + $outdent + ')';
}


//Map depth-adder
//-------------------------
// Adds 'base'(or whatever initial key that's passed in) to a color map.
// Used by color map generator function (colors/_colorfunctions)
//--------------------------
// 1. Check if map is less than or equal to the depth tolerance (default: 1).
// 2. loops through all keys and values in the map.
// 3. Make sure value isn't alreayd a map
//   3a. If value is a map, then check to make sure $new-key is in the map
//     3b. Duplicate first value of map (in case there are multiple)
//     3c. Create new map with new-key and duplicated value
// 4. Reformats those key-value pairs into a (key: (new-key: value ))
// 5. Merges new depthy key-key-value back into the map.
// 6. Returns the new map.

@function map-add-depth($map, $new-key: base){
	$formatted-key:(); $new-map:'';

	@each $key, $value in $map { 				//[2]
		$formatted-key: ();
		@if type-of($value) != "map" {                      //[3]
			$formatted-key: ($key: ($new-key: $value));     //[4]

		}@else if not map-has-key($value, $new-key) {       //[3a]
			$duplicate-value: map-get($value, nth(map-keys($value), 1)); //[3b]
			$duplicate-map: ($new-key : $duplicate-value);               //[3c]

			$formatted-key: ($key: (map-merge($value, $duplicate-map))); //[4]
		}
		$map: map-merge($map, $formatted-key);		//[5]
	}

	@return $map; 									//[6]
}


//-----------------------------------
//    $PHOTOSHOP LAYER STYLE MIMICS
//-----------------------------------

//Photoshop shadow mimic
// Allows you to use photoshop drop/inner shadow settings to generate CSS shadows

@function photoshop-shadow (
	$color: #000,
	$angle: 120,
	$distance: 0,
	$size: 0,
	$spread: 0,
	$inner: false
) {

	$x-offset: round( cos( $angle ) * $distance );
	$y-offset: round( sin( $angle ) * $distance );
	$css-spread: $size * ( $spread/100 );
	$blur: $size - $css-spread;
	$inset: if( $inner != false, 'inset', '' );

	@return ( $x-offset $y-offset $blur $css-spread $color unquote($inset) );
}

//Photoshop text-shadow converter
// Same as above, but for text-shadows
@function photoshop-text-shadow (
	$color: #000,
	$angle: 120deg,
	$distance: 0,
	$size: 0,
	$spread: null
) {

	@if $spread != null {
		@warn "spread has no effect for text shadows";
	}

	$shadow: photoshop-shadow( $color, $angle, $distance, $size, $spread);

	@return ( nth( $shadow, 1 ) nth( $shadow, 2 ) nth( $shadow, 3 ) nth( $shadow, 5 ) );
}

//Photoshop gradient overlay converter

@function photoshop-gradient-overlay(
	$gradient-colors: (#000, #fff),
	$gradient-stops: (0%, 100%),
	$angle: 90deg,
	$opacity: 100%,
	$scale: 100%,
	$bg-color: white,
	$blend: normal
) {
	$gradient-stops: (0%, 100%) !default;
	$css-angle: convert-angle($angle);
	$color-stops: ();

	@for $i from 1 through length($gradient-colors) {
		$blended-color: blend($blend, nth($gradient-colors, $i), $bg-color);
		$stop: join($blended-color, stop-scale(nth($gradient-stops, $i), $scale), space);
		$color-stops: append($color-stops, $stop, comma);
	}
	@return linear-gradient($css-angle, $color-stops);
}

//Convert angles for css gradients
@function convert-angle($angle) {

	@if $angle == 0 or $angle == 360 {
		@return left;
	} @else if $angle == 45 or $angle == -315 {
		@return left bottom;
	} @else if $angle == 90 or $angle == -270 {
		@return bottom;
	} @else if $angle == 135 or $angle == -225{
		@return right bottom;
	} @else if $angle == 180 or $angle == 180{
		@return right;
	} @else if $angle == -135 or $angle == 225 {
		@return right top;
	} @else if $angle == -90 or $angle == 270 {
		@return top;
	} @else if $angle == -45 or $angle == 315 {
		@return left top;
	} @else {
		@return $angle - 90deg;
	}
}

//Photoshop gradient stop converter
// Used in gradient overlay function
@function stop-scale($stop, $scale) {
	$stop: percentage-to-decimal($stop);
	$new-stop: 0;
	$scale: percentage-to-decimal($scale);

	@return percentage($scale * $stop - (0.5 * ($scale - 1)));
}

//------------------------------------
//    $TYPOGRAPHY
//------------------------------------

//Baseline function. Converts to floated integer.
@function baseline($font-size, $baseline){
	@return ceil($font-size / $baseline) * ($baseline) / $font-size;
}

//Calculate the least-common-denominator between a font-size and a baseline.
@function baseline-lcm($font-size, $line-height){
	$esl: $line-height * $font-size;
	@return lcm( $esl, $base-line-height );
}

// Calculate the baseline of any particular font-size.
@function baseline-calc(
	$font-size: $base-font-size,
	$font-base: $base-font-size,
	$calc-override: false){

	//Easiest measurement of font-size deviation
	$font-ratio: $font-size / $font-base;
	//baseline
	$bl: $type-magic-ratio * $font-base;
	//Every other line.
	$baseline-odd: $base-line-height / 2;
	//Every third line.
	$baseline-odder: $base-line-height / 1.33333;
	$baseline-cache: $bl;

	// Using half-baseline grid for first calculation.
	// This is helpful for smaller font-sizes
	// and gives more leeway with larger ones.

	$baseline: baseline($font-size, $baseline-odd);
	//If this produces either too small or large a line-height,
	// then let's make some corrections.
	// This will only work on fonts larger than the base-font-size unless
	// $calc-override is set to true.
	@if $font-size > $font-base or $calc-override == true {

		//First we can try using every third line.
		@if $baseline > 1.8 or $baseline <= 1.2{
				$baseline-cache: $baseline;
				$baseline: baseline($font-size, $baseline-odder);
		}
		@if $baseline < 1.1 or $baseline > 1.9{
			//If that's not working, let's see if
			// our original value is better by loosening our tolerance.
			@if $baseline-cache > 1.1 and $baseline-cache < 1.9{
				$baseline: $baseline-cache;
			}@else{
				//If both options are bad, then let's use the standard baseline.
				$baseline: baseline($font-size, $base-line-height);
			}
		}
	}
	@return $baseline;
}

//Generates a number based on the typographic grid
@function type-space($multiplier: 2){
	@return $multiplier * $base-line-height;
}

//------------------------------------
//    $MODULAR SCALE
//------------------------------------

// Modular scale function to scale type up or down.
@function modular-scale($i, $scale: $scale-ratio){
	$modular-scale: $scale;
	$stripped-base-font-size:  strip-units($base-font-size) !global;
	@return pow($modular-scale, $i)*($stripped-base-font-size) * 1px;
}

//Get the property of a particular font. e.g.:
// h1{
//    font-size: type(h2, px)
// }
// Would return the pixel value of the h2 font-size.
@function get-type($font-size, $property: 'px'){
	@if $property == 'font-size'{
		$property: 'px';
	}
	@return map-get(map-get($type, $font-size), $property);
}
//ALIAS: shorter name (possibly more confusing)
@function type($font-size, $property: 'px') {
	@return get-type($font-size, $property);
}

//Internal function used for definining the type map.
@function define-type($font-size, $property: 'px', $new-value: "") {
	$target_font: map-get($type, $font-size);
	$target-w-property: map-merge($target_font, ($property : $new-value));
	@return map-merge($type, ($font-size:$target-w-property));
}
